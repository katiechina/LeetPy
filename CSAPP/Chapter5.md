# 深入理解计算机系统（5）

- 深度参考 Datawhale CSAPP教程

## 一、 程序的性能
时钟周期 = a + b * （程序的数据规模）
程序的数据规模越大， 运行时间就主要由线性因子 b 来决定
b  -->  度量程序性能的标准，称为每元素的周期数（Cycles Per Element, CPE）

CPE越小，表示程序执行的越快

1. 编译器优化
2. 代码移动
    - 编译器不能判断代码移动会不会带来副作用，不会去自动做代码移动，需要程序员在编码时判断，减少不必要的函数调用
    - 消除不必要的内存引用，读写操作频繁会降低程序性能
3. 处理器优化
    - 指令控制单元、指令执行单元
    - 程序执行时并行、乱序执行、投机执行（预测，提前执行，如果失败，丢弃，如果成功，保存到内存或寄存器）
    - Latency（延迟） 完成一个指令需要的所有时钟周期
    - Issue（发射时间）  相同的指令需要的最小间隔时钟周期
    - Capacity（容量）同一个时钟周期可以最多容纳多少个指令
    - Latency bounds（延迟界限）
    - Throughput （吞吐量界限）
    - 总的来说，加法耗时 < 乘法 < 除法， 整数 < 浮点数
4. 循环展开
    - 循环展开可以提升程序性能，但是止步于延迟界限，如果达到了界限，多次展开也不会提高程序性能
    - 通过修改代码，并行执行两个循环或多个循环，可以突破延迟界限，接近吞吐量界限
    - 到达吞吐量界限时，再次提高并行的数量，不会提高性能，有可能性能还会下降
    - 现代寄存器有16个变量来保存浮点数，一旦循环变量的浮点数超过可用寄存器的数量，多余的循环变量会保存在内存中，读取内存会降低程序性能

5. 加载操作
    - 从内存中读取数据到寄存器中
6. 存储操作
    - 将寄存器中数据写入内存
    - 写读相关会导致性能下降（读的操作依赖写的数据，指向同一内存地址）
7. 策略总结：
    - 针对具体问题选择适当的算法和数据结构
    - 基本编码原则（消除连续的循环调用和消除不必要的内存引用）
    - 根据硬件设计，通过循环展开等技术提高指令级并行
    

    

    



